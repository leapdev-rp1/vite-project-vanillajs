"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("uuid"),e=require("@leapdev/auth-agent/src/index.umd"),n=require("js-base64");function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var c=function(t,e){this.context=t,this.hostInfo=e},u=function(t,e,n,o,r){this.appSessionId=t,this.hostType=e,this.hostVersion=n,this.env=o,this.region=r},f={auth:{host:{dev:{au:"https://auth.dev.leap.services"},test:{au:"https://login.test.leap365.com.au",uk:"https://login.test.leap365.co.uk",us:"https://login.test.leap365.com",ca:"https://login.test.leap365.ca"},live:{au:"https://login.leap365.com.au",uk:"https://login.leap365.co.uk",us:"https://login.leap365.com",ca:"https://login.leap365.ca"}}}};function l(t,e){void 0===e&&(e=!1);var n=void 0,o=e?window.location.hash:window.location.search;if(o&&o.length>1)for(var r=o.substring(1).split("&"),s=0;void 0===n&&s<r.length;){var a=r[s].split("=");2===a.length&&a[0]===t&&(n=a[1]),s++}return n}function m(t){if(t)try{var e=t.split(".")[1];return JSON.parse(atob(e))}catch(t){return}}var d=function(){function n(t){this.registeredCommands={};var e=new u(t.appSessionId,t.host,null,t.env,t.region);this._leapContext=new c(void 0,e),this._isTrustedApp=!!t.trustedApp}var o=n.prototype;return o.init=function(t){var n=this;return"access_denied"===l("error")&&this.system.close(),new Promise((function(o,r){n.registerHostMessageHandler(n.leapContext.hostInfo.appSessionId,(function(s){var a=s.data;n.deregisterHostMessageHandler(n.leapContext.hostInfo.appSessionId);var i={context:a.context,hostInfo:n.leapContext.hostInfo};(!a.context||0===Object.keys(a.context).length&&a.matterContext)&&(i.context=a.matterContext);var l=t;if(a.hostInfo){if(n._isTrustedApp=a.isTrustedApp,i.hostInfo=new u(n.leapContext.hostInfo.appSessionId,a.hostInfo.hostType,a.hostInfo.hostVersion,a.hostInfo.env,a.hostInfo.region),n.isTrustedApp)return n._leapContext=new c(i.context,i.hostInfo),n.hostRelatedSetup(),o();if(!a.clientId)return r("Failed to load the clientId from the schema");l=a.clientId}else if(n.isTrustedApp)return n._userToken=a.authtoken,n._leapContext=new c(i.context,i.hostInfo),n.hostRelatedSetup(),o();n._leapContext=new c(i.context,i.hostInfo),n.hostRelatedSetup();var m=i.hostInfo.env.includes("live")?"live":i.hostInfo.env;e.AuthAgent.init({authHost:f.auth.host[m][i.hostInfo.region],clientId:l,autoLogin:!0,autoLogout:!1,uniqueSession:!1,scopes:["*"],autoRefreshToken:!1}).then((function(t){return o()}))})),n.retrieveContext()}))},o.getRefreshedAccessToken=function(){try{var t;return Promise.resolve(this.isTrustedApp?this.leapContext.hostInfo.hostVersion&&null!==(t=this.system.send({command:"internal.getAccessToken"},!0))&&void 0!==t?t:this._userToken:e.AuthAgent.getRefreshedAccessToken())}catch(t){return Promise.reject(t)}},o.getDecodedRefreshedAccessToken=function(){try{return Promise.resolve(this.getRefreshedAccessToken()).then(m)}catch(t){return Promise.reject(t)}},o.getUserInfo=function(){try{return Promise.resolve(e.AuthAgent.userInfo())}catch(t){return Promise.reject(t)}},o.registerHostMessageHandler=function(t,e){if(this.registeredCommands[t])throw new Error("Command already registered");this.registeredCommands[t]=e},o.deregisterHostMessageHandler=function(t){delete this.registeredCommands[t]},o.twoWayCall=function(e,n,o){var r=this,s=t.v4();return new Promise((function(t,a){r.registerHostMessageHandler(s,(function(e){r.deregisterHostMessageHandler(s),e.isSuccess?t(o(e.data)):a(new Error(e.error))})),n(s,e)}))},o.handleCommand=function(t,e){var n=this.registeredCommands[t];if(n&&e)n(JSON.parse(e));else{if(!n)throw new Error("Host command not registered");n()}},r(n,[{key:"leapContext",get:function(){return this._leapContext}},{key:"isTrustedApp",get:function(){return this._isTrustedApp}}]),n}(),p=function(){function t(t){this.fourd=t}var e=t.prototype;return e.createTimeEntry=function(t){this.fourd.call4Dv2("accounting.createTimeEntry",t)},e.createFeeEntry=function(t){this.fourd.call4Dv2("accounting.createFeeEntry",t)},e.createCostRecovery=function(t){this.fourd.call4Dv2("accounting.createCostRecovery",t)},e.createInvoice=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("accounting.createInvoice",n,t)}),(function(t){return!0}))},e.createOfficeReceipt=function(t){this.fourd.call4Dv2("accounting.createOfficeReceipt",t)},e.createOfficePayment=function(t){this.fourd.call4Dv2("accounting.createOfficePayment",t)},e.createOfficeJournal=function(t){this.fourd.call4Dv2("accounting.createOfficeJournal",t)},e.createTrustReceipt=function(t){this.fourd.call4Dv2("accounting.createTrustReceipt",t)},e.createTrustPayment=function(t){this.fourd.call4Dv2("accounting.createTrustPayment",t)},e.createTrustJournal=function(t){this.fourd.call4Dv2("accounting.createTrustJournal",t)},e.createTrustToOffice=function(t){this.fourd.call4Dv2("accounting.createTrustToOffice",t)},e.createOfficePaymentRequest=function(t){this.fourd.call4Dv2("accounting.createOfficePaymentRequest",t)},e.createTrustPaymentRequest=function(t){this.fourd.call4Dv2("accounting.createTrustPaymentRequest",t)},e.reloadFinancialSummary=function(t){this.fourd.call4Dv2("accounting.reloadFinancialSummary",t)},e.reloadTimeFeeList=function(t){this.fourd.call4Dv2("accounting.reloadTimeFeeList",t)},e.reloadOfficeLedger=function(t){this.fourd.call4Dv2("accounting.reloadOfficeLedger",t)},e.reloadAnticipatedPaymentList=function(t){this.fourd.call4Dv2("accounting.reloadAnticipatedPaymentList",t)},e.reloadCostRecoveryList=function(t){this.fourd.call4Dv2("accounting.reloadCostRecoveryList",t)},e.reloadTrustLedger=function(t){this.fourd.call4Dv2("accounting.reloadTrustLedger",t)},e.reloadControlledMoneyList=function(t){this.fourd.call4Dv2("accounting.reloadControlledMoneyList",t)},e.reloadPowerMoneyList=function(t){this.fourd.call4Dv2("accounting.reloadPowerMoneyList",t)},e.reloadTransitMoneyList=function(t){this.fourd.call4Dv2("accounting.reloadTransitMoneyList",t)},e.openFee=function(t){t.isAutoTime&&(t.timed=!0),this.fourd.call4Dv2("accounting.openFee",t)},t}(),h=function(){function t(t){this.fourd=t}return t.prototype.openApp=function(t){this.fourd.call4Dv2("app.openApp",t)},t}(),g=function(){function t(t){this.fourd=t}return t.prototype.evaluatePaths=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("calc.evaluatePaths",{method:"POST",url:"/api/evaluate/paths",body:n},t)}),(function(t){if(t.status>=400)throw new Error(JSON.parse(t.body).message);var e;try{e=JSON.parse(t.body)}catch(n){e=t.body}return e}))},t}(),v=function(){function t(t){this.fourd=t}var e=t.prototype;return e.composeEmail=function(t){this.fourd.call4Dv2("communication.composeEmail",t)},e.createAppointment=function(t){this.fourd.call4Dv2("communication.createAppointment",t)},e.createTask=function(t){this.fourd.call4Dv2("communication.createTask",t)},t}(),y=function(){function t(t){this.fourd=t}var e=t.prototype;return e.previewDocument=function(t){this.fourd.call4Dv2("document.previewDocument",t)},e.previewPrecedent=function(t){this.fourd.call4Dv2("document.previewPrecedent",t)},e.createDocumentFromContainer=function(t){this.fourd.call4Dv2("document.createDocumentFromContainer",t)},e.createDocumentFromPrecedent=function(t){this.fourd.call4Dv2("document.createDocumentFromPrecedent",t)},e.openDocument=function(t){this.fourd.call4Dv2("document.openDocument",t)},e.reloadDocumentList=function(t){this.fourd.call4Dv2("document.reloadDocumentList",t)},e.editPrecedent=function(t){this.fourd.call4Dv2("document.editPrecedent",t)},e.selectPrecedent=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("document.selectPrecedent",n,t)}),(function(t){return t}))},t}(),w=function(){function t(t){this.fourd=t}return t.prototype.orderSearch=function(t){this.fourd.call4Dv2("infotrack.orderSearch",t)},t}(),D=function(){function t(t){this.fourd=t}var e=t.prototype;return e.shareDocuments=function(t){this.fourd.call4Dv2("lawconnect.shareDocuments",t)},e.shareFolder=function(t){this.fourd.call4Dv2("lawconnect.shareFolder",t)},e.shareOfficeStatement=function(t){this.fourd.call4Dv2("lawconnect.shareOfficeStatement",t)},e.shareTrustStatement=function(t){this.fourd.call4Dv2("lawconnect.shareTrustStatement",t)},t}(),M=function(){function t(t){this.fourd=t}var e=t.prototype;return e.openTable=function(t){null==t&&(t.order=1),this.fourd.call4Dv2("matter.openTable",t)},e.openMatter=function(t){this.fourd.call4Dv2("matter.openMatter",t)},e.selectMatter=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("matter.selectMatter",n,t)}),(function(t){var n,o;return null===(n=e.fourd.leapContext)||void 0===n||null===(o=n.hostInfo)||void 0===o||!o.hostVersion||e.fourd.leapContext.hostInfo.hostVersion<"2.4.280.0"?t.map((function(t){var e=s({},t,{deleted:t.delete,matterTypeId:""});return delete e.delete,e})):t}))},t}(),C=function(){function t(t){this.fourd=t}var e=t.prototype;return e.shareDocument=function(t){this.fourd.call4Dv2("msteams.shareDocument",t)},e.shareMatter=function(t){this.fourd.call4Dv2("msteams.shareMatter",t)},e.requestCallback=function(t){this.fourd.call4Dv2("msteams.requestCallback",t)},t}(),_=function(){function t(t){this.fourd=t}var e=t.prototype;return e.reloadDocumentRegisterList=function(t){this.fourd.call4Dv2("register.reloadDocumentRegisterList",t)},e.reloadPowerEstateList=function(t){this.fourd.call4Dv2("register.reloadPowerEstateList",t)},t}(),I=function(){function t(t){this.fourd=t}var e=t.prototype;return e.customiseList=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("schema.customiseList",n,t)}),(function(t){return t}))},e.getLists=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("schema.getLists",n,t)}),(function(t){return t}))},t}(),T=function(){function t(t){this.fourd=t,this.isString=function(t){return"string"==typeof t||t instanceof String}}var e=t.prototype;return e.openTwitter=function(t){this.fourd.call4Dv2("system.openTwitter",t)},e.close=function(){this.fourd.call4Dv2("system.close")},e.hide=function(){this.fourd.call4Dv2("system.hide")},e.wait=function(t){this.fourd.call4Dv2("system.wait",t)},e.resume=function(){this.fourd.call4Dv2("system.resume")},e.cancelClose=function(){this.fourd.call4Dv2("system.cancelClose")},e.alert=function(t){this.isString(t.message)&&t.message&&this.fourd.call4Dv2("system.alert",t)},e.error=function(t){this.isString(t.message)&&t.message&&this.fourd.call4Dv2("system.error",t)},e.openDialog=function(t){var e=this;if(!this.isString(t.message)||!t.message)throw new Error("Invalid value in message");if(!t.dialogType)throw new Error("DialogType cannot be null");return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("system.openDialog",n,t)}),(function(t){return t}))},e.openUrl=function(t){t.action="OpenURL",this.fourd.call4Dv2("system.openUrl",t)},e.getSystemInfo=function(){var t=this;return this._systemInfo?Promise.resolve(this._systemInfo):this.fourd.twoWayCall(null,(function(e,n){t.fourd.call4Dv2("system.getSystemInfo",n,e)}),(function(e){return t._systemInfo=e,e}))},e.setWindowTitle=function(t){this.fourd.call4Dv2("system.setWindowTitle",t)},e.onBeforeClose=function(t){var e=this;t().then((function(t){t&&e.cancelClose()}))},e.send=function(t,e){void 0===e&&(e=!1);try{var n=this;if(!n.fourd.isTrustedApp)throw new Error("Permission error");if(null==t)throw new Error("Bad request");return"object"==typeof t&&t.command?e?Promise.resolve(n.fourd.twoWayCall(t,(function(t,e){n.fourd.call4Dv2(e.command,e.request,t)}),(function(t){return t}))):(n.fourd.call4Dv2(t.command,t.request),Promise.resolve()):e?Promise.resolve(n.fourd.twoWayCall(t,(function(t,e){n.fourd.call4Dv2("system.send",e,t)}),(function(t){return t}))):(n.fourd.call4Dv2("system.send",t),Promise.resolve())}catch(t){return Promise.reject(t)}},e.sendLegacy=function(t){var e=this;return"object"==typeof t&&t.requestId?new Promise((function(n,o){e.fourd.registerHostMessageHandler(t.requestId,(function(r){if(e.fourd.deregisterHostMessageHandler(t.requestId),"object"==typeof r&&r){var s=r.hasOwnProperty("isSuccess"),a=r.hasOwnProperty("error"),i=r.hasOwnProperty("data");s&&(a||i)&&(r.isSuccess?n(r.data):o(new Error(r.error)))}else n(r)})),e.fourd.call4D(e.fourd.to4DJSONString(t))})):(this.fourd.call4D(this.fourd.to4DJSONString(t)),Promise.resolve())},e.finishLoading=function(){this.fourd.call4Dv2("system.finishLoading")},t}(),P=function(){function t(t){this.fourd=t}var e=t.prototype;return e.selectCard=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("card.selectCard",n,t)}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.createCard=function(){var t=this;return this.fourd.twoWayCall(null,(function(e,n){t.fourd.call4Dv2("card.createCard",n,e)}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.openCard=function(t){this.fourd.call4Dv2("card.openCard",t)},t}(),k=function(){function t(t){this.fourd=t}return t.prototype.selectStaff=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("staff.selectStaff",n,t)}),(function(t){var n,o;return null===(n=e.fourd.leapContext)||void 0===n||null===(o=n.hostInfo)||void 0===o||!o.hostVersion||e.fourd.leapContext.hostInfo.hostVersion<"2.4.280.0"?t.map((function(t){var e=s({},t,{staffId:t.staffGUID,userId:t.userGUID,branchId:t.branchGUID});return delete e.staffGUID,delete e.userGUID,delete e.branchGUID,e})):t}))},t}(),S=function(){function t(t){this.fourd=t}var e=t.prototype;return e.selectPerson=function(t){var e=this;return this.fourd.twoWayCall(t,(function(t,n){e.fourd.call4Dv2("person.selectPerson",n,t)}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.openPerson=function(t){this.fourd.call4Dv2("person.openPerson",t)},t}(),L=function(t){function e(e){var n;return void 0===e&&(e=void 0),(n=t.call(this,e)||this).protocol="Fourd://",n._accounting=new p(i(n)),n._app=new h(i(n)),n._calc=new g(i(n)),n._communication=new v(i(n)),n._document=new y(i(n)),n._infotrack=new w(i(n)),n._lawconnect=new D(i(n)),n._person=new S(i(n)),n._matter=new M(i(n)),n._msteams=new C(i(n)),n._register=new _(i(n)),n._schema=new I(i(n)),n._system=new T(i(n)),n._card=new P(i(n)),n._staff=new k(i(n)),n.setupHostMessageEventHandler(),n}a(e,t);var o=e.prototype;return o.retrieveContext=function(){this.call4Dv2("RetrieveLeapAppContext",{},this.leapContext.hostInfo.appSessionId)},o.to4DJSONString=function(t,e){return void 0===e?"json="+n.Base64.encode(JSON.stringify(t)):JSON.stringify(t)},o.call4D=function(t){window.$4d?(t=this.protocol+t,window.$4d.WebArea_RequestHandler(t)):(t=this.protocol+t,window.location.assign(t))},o.call4Dv2=function(t,e,n){void 0!==e&&"object"!=typeof e||(e=s({},e||{},{appSessionId:this.leapContext.hostInfo.appSessionId}),n&&(e=s({},e,{requestId:n}))),this.call4D(this.to4DJSONString({command:t,request:e,sdkVersion:2}))},o.hostRelatedSetup=function(){},o.setupHostMessageEventHandler=function(){var e=this;window.handleHostMessage=function(n,o){return t.prototype.handleCommand.call(e,n,o)}},r(e,[{key:"accounting",get:function(){return this._accounting}},{key:"app",get:function(){return this._app}},{key:"calc",get:function(){return this._calc}},{key:"card",get:function(){return this._card}},{key:"communication",get:function(){return this._communication}},{key:"document",get:function(){return this._document}},{key:"infotrack",get:function(){return this._infotrack}},{key:"lawconnect",get:function(){return this._lawconnect}},{key:"matter",get:function(){return this._matter}},{key:"msteams",get:function(){return this._msteams}},{key:"person",get:function(){return this._person}},{key:"register",get:function(){return this._register}},{key:"schema",get:function(){return this._schema}},{key:"system",get:function(){return this._system}},{key:"staff",get:function(){return this._staff}}]),e}(d),O={dev_au:["https://dev.leap365.com.au","https://dev.leapjd.com.au/"],test_au:["https://test.leap365.com.au","https://test-epic1.leap365.com.au","https://reporting-test.leapaws.com.au","https://reporting-dev.leapaws.com.au","https://leapcalc-renderer-au-test.leap.services","https://test.leapjd.com.au","https://test.leapjd.co.nz"],live_au:["https://staging.leap365.com.au","https://sandbox.leap365.com.au","https://app.leap365.com.au","https://reporting.leapaws.com.au","https://leapcalc-renderer-au-live.leap.services"],liveb_au:["https://staging.liveb.leap365.com.au","https://liveb.leap365.com.au"],test_uk:["https://test.leap365.co.uk","https://reporting-test.leapaws.co.uk","https://leapcalc-renderer-uk-test.leap.services","https://test.leapjd.co.uk"],live_uk:["https://app.leap365.co.uk","https://staging.leap365.co.uk","https://sandbox.leap365.co.uk","https://reporting.leapaws.co.uk","https://leapcalc-renderer-uk-live.leap.services"],test_us:["https://test.leap365.com","https://reporting-test.leapaws.com","https://leapcalc-renderer-us-test.leap.services","https://test.leapjd.com"],live_us:["https://app.leap365.com","https://staging.leap365.com","https://sandbox.leap365.com","https://reporting.leapaws.com","https://leapcalc-renderer-us-live.leap.services"],test_ca:["https://test.leap365.ca","https://reporting.test.leapaws.ca","https://renderer.test.ca.leap.services","https://test.leapjd.ca"],live_ca:["https://app.leap365.ca","https://staging.leap365.ca","https://sandbox.leap365.ca","https://reporting.leapaws.ca","https://renderer.ca.leap.services"]},b=["http://localhost:53504","http://localhost:8080","http://localhost:9005"],x=function(){function t(t){this.iframe=t}var e=t.prototype;return e.createTimeEntry=function(t){this.iframe.postMessage({command:"accounting.createTimeEntry",args:t})},e.createFeeEntry=function(t){this.iframe.postMessage({command:"accounting.createFeeEntry",args:t})},e.createCostRecovery=function(t){this.iframe.postMessage({command:"accounting.createCostRecovery",args:t})},e.createInvoice=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"accounting.createInvoice",args:s({},n,{requestId:t})})}),(function(t){return t}))},e.createOfficeReceipt=function(t){this.iframe.postMessage({command:"accounting.createOfficeReceipt",args:t})},e.createOfficePayment=function(t){this.iframe.postMessage({command:"accounting.createOfficePayment",args:t})},e.createOfficeJournal=function(t){this.iframe.postMessage({command:"accounting.createOfficeJournal",args:t})},e.createTrustReceipt=function(t){this.iframe.postMessage({command:"accounting.createTrustReceipt",args:t})},e.createTrustPayment=function(t){this.iframe.postMessage({command:"accounting.createTrustPayment",args:t})},e.createTrustJournal=function(t){this.iframe.postMessage({command:"accounting.createTrustJournal",args:t})},e.createTrustToOffice=function(t){this.iframe.postMessage({command:"accounting.createTrustToOffice",args:t})},e.createOfficePaymentRequest=function(t){this.iframe.postMessage({command:"accounting.createOfficePaymentRequest",args:t})},e.createTrustPaymentRequest=function(t){this.iframe.postMessage({command:"accounting.createTrustPaymentRequest",args:t})},e.reloadFinancialSummary=function(t){this.iframe.postMessage({command:"accounting.reloadFinancialSummary",args:t})},e.reloadTimeFeeList=function(t){this.iframe.postMessage({command:"accounting.reloadTimeFeeList",args:t})},e.reloadOfficeLedger=function(t){this.iframe.postMessage({command:"accounting.reloadOfficeLedger",args:t})},e.reloadAnticipatedPaymentList=function(t){this.iframe.postMessage({command:"accounting.reloadAnticipatedPaymentList",args:t})},e.reloadCostRecoveryList=function(t){this.iframe.postMessage({command:"accounting.reloadCostRecoveryList",args:t})},e.reloadTrustLedger=function(t){this.iframe.postMessage({command:"accounting.reloadTrustLedger",args:t})},e.reloadControlledMoneyList=function(t){this.iframe.postMessage({command:"accounting.reloadControlledMoneyList",args:t})},e.reloadPowerMoneyList=function(t){this.iframe.postMessage({command:"accounting.reloadPowerMoneyList",args:t})},e.reloadTransitMoneyList=function(t){this.iframe.postMessage({command:"accounting.reloadTransitMoneyList",args:t})},e.openFee=function(t){t.isAutoTime&&(t.timed=!0),this.iframe.postMessage({command:"accounting.openFee",args:t})},t}(),R=function(){function t(t){this.iframe=t}return t.prototype.openApp=function(t){this.iframe.postMessage({command:"app.openApp",args:t})},t}(),q=function(){function t(t){this.iframe=t}return t.prototype.evaluatePaths=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"calc.evaluatePaths",args:s({},n,{requestId:t})})}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},t}(),A=function(){function t(t){this.iframe=t}var e=t.prototype;return e.composeEmail=function(t){this.iframe.postMessage({command:"communication.composeEmail",args:t})},e.createAppointment=function(t){this.iframe.postMessage({command:"communication.createAppointment",args:t})},e.createTask=function(t){this.iframe.postMessage({command:"communication.createTask",args:t})},t}(),W=function(){function t(t){this.iframe=t}var e=t.prototype;return e.previewDocument=function(t){this.iframe.postMessage({command:"document.previewDocument",args:t})},e.previewPrecedent=function(t){this.iframe.postMessage({command:"document.previewPrecedent",args:t})},e.createDocumentFromContainer=function(t){this.iframe.postMessage({command:"document.createDocumentFromContainer",args:t})},e.createDocumentFromPrecedent=function(t){this.iframe.postMessage({command:"document.createDocumentFromPrecedent",args:t})},e.openDocument=function(t){this.iframe.postMessage({command:"document.openDocument",args:t})},e.reloadDocumentList=function(t){this.iframe.postMessage({command:"document.reloadDocumentList",args:t})},e.editPrecedent=function(t){this.iframe.postMessage({command:"document.editPrecedent",args:t})},e.selectPrecedent=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"document.selectPrecedent",args:s({},n,{requestId:t})})}),(function(t){return t}))},t}(),E=function(){function t(t){this.iframe=t}return t.prototype.orderSearch=function(t){this.iframe.postMessage({command:"infotrack.orderSearch",args:t})},t}(),F=function(){function t(t){this.iframe=t}var e=t.prototype;return e.shareDocuments=function(t){this.iframe.postMessage({command:"lawconnect.shareDocuments",args:t})},e.shareFolder=function(t){this.iframe.postMessage({command:"lawconnect.shareFolder",args:t})},e.shareOfficeStatement=function(t){this.iframe.postMessage({command:"lawconnect.shareOfficeStatement",args:t})},e.shareTrustStatement=function(t){this.iframe.postMessage({command:"lawconnect.shareTrustStatement",args:t})},t}(),H=function(){function t(t){this.iframe=t}var e=t.prototype;return e.openTable=function(t){this.iframe.postMessage({command:"matter.openTable",args:t})},e.openMatter=function(t){this.iframe.postMessage({command:"matter.openMatter",args:t})},e.selectMatter=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"matter.selectMatter",args:s({},n,{requestId:t})})}),(function(t){return t}))},t}(),j=function(){function t(t){this.iframe=t}var e=t.prototype;return e.shareDocument=function(t){this.iframe.postMessage({command:"msteams.shareDocument",args:t})},e.shareMatter=function(t){this.iframe.postMessage({command:"msteams.shareMatter",args:t})},e.requestCallback=function(t){this.iframe.postMessage({command:"msteams.requestCallback",args:t})},t}(),J=function(){function t(t){this.iframe=t}var e=t.prototype;return e.selectCard=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"card.selectCard",args:s({},n,{requestId:t})})}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.createCard=function(){var t=this;return this.iframe.twoWayCall(null,(function(e,n){t.iframe.postMessage({command:"card.createCard",args:s({},n,{requestId:e})})}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.openCard=function(t){this.iframe.postMessage({command:"card.openCard",args:t})},t}(),N=function(){function t(t){this.iframe=t}return t.prototype.selectStaff=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"staff.selectStaff",args:s({},n,{requestId:t})})}),(function(t){return t}))},t}(),U=function(){function t(t){this.iframe=t}var e=t.prototype;return e.reloadDocumentRegisterList=function(t){this.iframe.postMessage({command:"register.reloadDocumentRegisterList",args:t})},e.reloadPowerEstateList=function(t){this.iframe.postMessage({command:"register.reloadPowerEstateList",args:t})},t}(),V=function(){function t(t){this.iframe=t}var e=t.prototype;return e.customiseList=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"schema.customiseList",args:s({},n,{requestId:t})})}),(function(t){return t}))},e.getLists=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"schema.getLists",args:s({},n,{requestId:t})})}),(function(t){return t}))},t}(),G=function(){function t(t){this.iframe=t}var e=t.prototype;return e.openTwitter=function(t){throw new Error("Not supported")},e.close=function(){this.iframe.postMessage({command:"system.close"})},e.hide=function(){this.iframe.postMessage({command:"system.hide"})},e.wait=function(t){this.iframe.postMessage({command:"system.wait",args:t})},e.resume=function(){this.iframe.postMessage({command:"system.resume"})},e.cancelClose=function(){this.iframe.postMessage({command:"system.cancelClose"})},e.alert=function(t){this.iframe.postMessage({command:"system.alert",args:t})},e.error=function(t){this.iframe.postMessage({command:"system.error",args:t})},e.openDialog=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"system.openDialog",args:s({},n,{requestId:t})})}),(function(t){return t}))},e.openUrl=function(t){this.iframe.postMessage({command:"system.openUrl",args:t})},e.getSystemInfo=function(){var t=this;return this._systemInfo?Promise.resolve(this._systemInfo):this.iframe.twoWayCall(null,(function(e){t.iframe.postMessage({command:"system.getSystemInfo",args:{requestId:e}})}),(function(e){return t._systemInfo=e,e}))},e.setWindowTitle=function(t){this.iframe.postMessage({command:"system.setWindowTitle",args:t})},e.onBeforeClose=function(t){var e=this;t().then((function(t){t&&e.cancelClose()}))},e.send=function(t,e){var n=this;if(void 0===e&&(e=!1),!this.iframe.isTrustedApp)throw new Error("Permission error");if(null==t)throw new Error("Bad request");return"object"==typeof t&&e?this.iframe.twoWayCall(t,(function(t,e){n.iframe.postMessage({command:"system.send",args:s({},e,{requestId:t})})}),(function(t){return t})):(this.iframe.postMessage({command:"system.send",args:t}),Promise.resolve())},e.finishLoading=function(){this.iframe.postMessage({command:"system.finishLoading"})},t}(),B=function(){function t(t){this.iframe=t}var e=t.prototype;return e.selectPerson=function(t){var e=this;return this.iframe.twoWayCall(t,(function(t,n){e.iframe.postMessage({command:"person.selectPerson",args:s({},n,{requestId:t})})}),(function(t){var e;try{e=JSON.parse(t)}catch(n){e=t}return e}))},e.openPerson=function(t){this.iframe.postMessage({command:"person.openPerson",args:t})},t}(),$=function(t){function e(e,n){var o;return void 0===n&&(n=!1),(o=t.call(this,e)||this)._accounting=new x(i(o)),o._app=new R(i(o)),o._calc=new q(i(o)),o._card=new J(i(o)),o._communication=new A(i(o)),o._document=new W(i(o)),o._infotrack=new E(i(o)),o._lawconnect=new F(i(o)),o._matter=new H(i(o)),o._msteams=new j(i(o)),o._person=new B(i(o)),o._register=new U(i(o)),o._schema=new V(i(o)),o._staff=new N(i(o)),o._system=new G(i(o)),o.parentWindow=n?window.opener:window.parent,o.registerMessageEventListener(),o}a(e,t);var n=e.prototype;return n.retrieveContext=function(){this.postMessage({command:"RetrieveLeapAppContext",args:{requestId:this.leapContext.hostInfo.appSessionId}})},n.hostRelatedSetup=function(){"web"===this.leapContext.hostInfo.hostType&&(this._whiteListedHostDomains=[].concat(O[this.leapContext.hostInfo.env+"_"+this.leapContext.hostInfo.region]||[],b,["https://leaphost.test.leap365.com.au","http://my.leapjd"]))},n.postMessage=function(t){var e,n,o,r;t.args=s({},t.args||{}),null!==(e=this.leapContext)&&void 0!==e&&null!==(n=e.hostInfo)&&void 0!==n&&n.appSessionId&&(t.args.appSessionId=null===(o=this.leapContext.hostInfo)||void 0===o?void 0:o.appSessionId),t.sdkVersion=null!==(r=t.sdkVersion)&&void 0!==r?r:2,this.parentWindow.postMessage(t,"*")},n.registerMessageEventListener=function(){window.addEventListener("message",this.receiveMessage.bind(this),!1)},n.receiveMessage=function(e){var n;if((!((null===(n=this._whiteListedHostDomains)||void 0===n?void 0:n.length)>0)||this._whiteListedHostDomains.includes(e.origin))&&e.data.command){var o=e.data.command;e.data.payload?t.prototype.handleCommand.call(this,o,e.data.payload):t.prototype.handleCommand.call(this,o)}},r(e,[{key:"accounting",get:function(){return this._accounting}},{key:"app",get:function(){return this._app}},{key:"calc",get:function(){return this._calc}},{key:"card",get:function(){return this._card}},{key:"communication",get:function(){return this._communication}},{key:"document",get:function(){return this._document}},{key:"infotrack",get:function(){return this._infotrack}},{key:"lawconnect",get:function(){return this._lawconnect}},{key:"matter",get:function(){return this._matter}},{key:"msteams",get:function(){return this._msteams}},{key:"staff",get:function(){return this._staff}},{key:"person",get:function(){return this._person}},{key:"register",get:function(){return this._register}},{key:"schema",get:function(){return this._schema}},{key:"system",get:function(){return this._system}}]),e}(d),z=function(){function t(){}return t.getInstance=function(){var t=this.getRequestContext();if(!t)return null;var e="true"===(l("newTab")||"").toLowerCase();return window.$4d||"desktop"===t.host?new L(t):new $(t,e)},t.getRequestContext=function(){var t,e=l("appSessionId");if(!e)return null;var n=null!==(t=l("host"))&&void 0!==t?t:"desktop",o=l("env"),r=l("region"),s="true"===(l("trustedApp")||"").toLowerCase();return o&&(o.includes("liveb")?o="liveb":o.includes("live")?o="live":o.includes("test")?o="test":o.includes("dev")&&(o="dev")),{appSessionId:e,host:n,env:o,region:r,trustedApp:s}},t}();exports.LeapContext=c,exports.LeapHostSdkFactory=z;
//# sourceMappingURL=leaphost.cjs.production.min.js.map
