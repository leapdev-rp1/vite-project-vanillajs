# LEAP Host SDK

LEAP Host SDK is a TypeScript library that helps your LEAP apps (formerly known as LEAP addins) communicate easily with LEAP client applications.

## How to install

This library should be installed as an npm package. We use semantic versioning so the best way to stay up-to-date without backward compatibility concern is to accept minor releases:

```
npm i @leapdev/leap-host
```

## How to use

**In order to have all the features supported, please develop with the latest LEAP desktop 2.3 or above**

The first thing you have to do is to initialise the SDK

```typescript
import { LeapHostSdkFactory } from '@leapdev/leap-host';

const sdk = LeapHostSdkFactory.getInstance();
if (!!sdk) {
  sdk.init('LEAP Auth client ID').then(() => {
    //you can start calling APIs
  });
}
```

This `init` function returns a `Promise`. We recommend that you do this initialisation once and cache the promise result in memory.

By awaiting the promise, you then have access to methods that perform actions in the LEAP client applications. Please refer to the [API reference](#api-reference) for all supported methods.

## TL;DR

### Abstracting LEAP context retrieval

A LEAP app needs to know the context of where its being loaded, e.g. the matterId where it is loaded, which record is being selected (if the current page in LEAP is a list), etc. The LEAP app is expected to retrieve the context object from the hosting LEAP client application. A connection between the LEAP client application and LEAP app is assigned a unique guid. The LEAP app can access this value via "appSessionId" property received.

The LEAP Host SDK abstracts the context retrieval process by presenting a unified API to the LEAP app. By calling the init function, the LEAP app will have access to the context object as follow.

```typescript
import { LeapHostSdkFactory } from '@leapdev/leap-host';

const sdk = LeapHostSdkFactory.getInstance();
if (!!sdk) {
  sdk.init().then(() => {
    console.log(sdk.leapContext);
  });
}
```

### Obtaining LEAP Auth token

A LEAP app often needs to call the LEAP API Gateway services. To do so, it needs to obtain a LEAP Auth token. LEAP Host SDK simplifies this process.

```typescript
sdk.init('LEAP Auth client ID').then(() => {
  //client Id is not required if you have provided the token in the url
  //or you are developping a trusted app

  if (!!sdk.leapContext.authtoken) {
    //you can check if the SDK is ready by checking if the authtoken has value
    console.log(sdk.leapContext.authtoken);
  }
});
```

### Sending a command to the LEAP client application

A LEAP client applications (LEAP Desktop / Web / Mobile) accepts certain messages from LEAP apps and act upon them. For example, they can open a document or show a message box.

The LEAP Host SDK facilitates this process by exposing a set of semantic functions through which the LEAP app can invoke.

```typescript
sdk.init('LEAP Auth client ID').then(() => {
  // open a message box in LEAP
  sdk.system.alert({ message: 'Hello, world' });

  // open a matter
  sdk.matter.openMatter(openMatterRequest);

  // close the app
  sdk.system.close();
});
```

## API reference

### Accounting

#### Create a time entry

```typescript
createTimeEntry(request: CreateTimeEntryRequest): void;
```

#### Create a fee entry

```typescript
createFeeEntry(request: CreateFeeEntryRequest): void;
```

#### Create a cost recovery

```typescript
createCostRecovery(request: CreateCostRecoveryEntryRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "appSessionId":"1fa55cbb-7b02-a546-94a2-8986be7fce5b"
};

sdk.accounting.createCostRecovery(request);
```

#### Create an invoice

```typescript
createInvoice(request: CreateInvoiceRequest): Promise<boolean>;
```

#### Create an office receipt

```typescript
createOfficeReceipt(request: CreateOfficeReceiptRequest): void;
```

#### Create an office payment

```typescript
createOfficePayment(request: CreateOfficePaymentRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "appSessionId":"1fa55cbb-7b02-a546-94a2-8986be7fce5b"
};

sdk.accounting.createOfficePayment(request);
```

#### Create an office payment request

```typescript
createOfficePaymentRequest(request: CreateNewOfficePaymentRequestRequest): void;
```

#### Create an trust payment request

```typescript
createTrustPaymentRequest(request: CreateNewTrustPaymentRequestRequest): void;
```

#### Create an office journal

```typescript
createOfficeJournal(request: CreateOfficeJournalRequest): void;
```

#### Create a trust receipt

```typescript
createTrustReceipt(request: CreateTrustReceiptRequest): void;
```

#### Create a trust payment

```typescript
createTrustPayment(request: CreateTrustPaymentRequest): void;
```

#### Create a trust journal

```typescript
createTrustJournal(request: CreateTrustJournalRequest): void;
```

#### Create trust to office

```typescript
createTrustToOffice(request: CreateTrustToOfficeRequest): void;
```

#### Reload the financial summary

```typescript
reloadFinancialSummary(request: ReloadFinancialSummaryRequest): void;
```

#### Reload the time fee list

```typescript
reloadTimeFeeList(request: ReloadTimeFeeListRequest): void;
```

#### Reload the office ledger

```typescript
reloadOfficeLedger(request: ReloadOfficeLedgerRequest): void;
```

#### Reload the anticipated payment list

```typescript
reloadAnticipatedPaymentList(request: ReloadAnticipatedPaymentListRequest): void;
```

#### Reload the cost recovery list

```typescript
reloadCostRecoveryList(request: ReloadCostRecoveryListRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "appSessionId":"1fa55cbb-7b02-a546-94a2-8986be7fce5b"
};

sdk.accounting.reloadCostRecoveryList(request);
```

#### Reload the trust ledger

```typescript
reloadTrustLedger(request: ReloadTrustLedgerRequest): void;
```

#### Reload the controlled money list

```typescript
reloadControlledMoneyList(request: ReloadControlledMoneyListRequest): void;
```

#### Reload the power money list

```typescript
reloadPowerMoneyList(request: ReloadPowerMoneyListRequest): void;
```

#### Reload the transit money list

```typescript
reloadTransitMoneyList(request: ReloadTransitMoneyListRequest): void;
```

#### Open a fee

```typescript
openFee(request: OpenFeeRequest): void;
```

### Calc

#### Evaluate paths

```typescript
evaluatePaths(request: EvaluatePathsRequest): Promise<PathResult[]>;

//Request example:
const request = {
  "executionContext": {
    "matterGUID": "a4a9a42d-2dd8-48c4-bf06-b213369a5c84"
  },
  "paths": ["matter.clientList.{__id,__className,__fileOrder,__description,personList}", "matter.fileNumber"]
};

sdk.calc.evaluatePaths(request)
.then(response =>{
  //handle the response here
});
```

### Card

#### Select card(s) from the list

```typescript
selectCard(request?: SelectCardRequest): Promise<Card[]>;
```

#### Create a card

```typescript
createCard(): Promise<CreatedCard[]>;
```

#### Open a card

```typescript
openCard(request: OpenCardRequest): void;
```

### Communication

#### Compose an email

```typescript
composeEmail(request: CreateEmailRequest): void;
```

#### Create an appointment

```typescript
createAppointment(request: CreateAppointmentRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "startDate": "2020-10-21T05:12:46.472Z",
  "endDate": "2020-10-22T05:13:46.472Z",
  "attachments":[],
  "requiredAttendees":[],
  "optionalAttendees":[]
};

sdk.communication.createAppointment(request);
```

#### Create a task

```typescript
createTask(request: CreateTaskRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "startDate":"2020-10-21T00:00:00.000Z",
  "dueDate":"2020-10-22T00:00:00.000Z"
};

sdk.communication.createTask(request);
```

### Document

#### Preview a document

```typescript
previewDocument(request: PreviewDocumentRequest): void;
```

#### Preview a Precedent

```typescript
previewPrecedent(request: PreviewPrecedentRequest): void;
```

#### Edit a Precedent

```typescript
editPrecedent(request: EditPrecedentRequest): void;
```

#### Get the details of a selected precedent

```typescript
selectPrecedent(request: SelectPrecedentRequest): Promise<SelectPrecedentResponse>;
```

#### Create a document from a container

```typescript
createDocumentFromContainer(request: CreateDocumentFromContainerRequest): void;
```

#### Create a document from a precedent

```typescript
createDocumentFromPrecedent(request: CreateDocumentFromPrecedentRequest): void;
```

#### Open a document

```typescript
openDocument(request: OpenDocumentRequest): void;

const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "documentId":"ba5e2173-e6bc-47b4-9280-787f78454e2b",
  "appSessionId":"b90402b8-c7cb-435b-b1fc-8bbcb1d49934"
};

sdk.document.openDocument(request);
```

#### Reload the document list

```typescript
reloadDocumentList(request: ReloadDocumentListRequest): void;
```

### LawConnect

#### Share documents

```typescript
shareDocuments(request: ShareDocumentsRequest): void;
```

#### Share a folder

```typescript
shareFolder(request: ShareFolderRequest): void;
```

#### Share an office statement

```typescript
shareOfficeStatement(request: ShareOfficeStatementRequest): void;
```

#### Share a trust statement

```typescript
shareTrustStatement(request: ShareTrustStatementRequest): void;
```

### Matter

#### Open a table

```typescript
openTable(request: OpenTableRequest): void;
```

#### Open a matter

```typescript
openMatter(request: OpenMatterRequest): void;

//Request example:
const request = {
  "matterId":"c2b1cbde-77ec-2642-91d9-09191e5258c6",
  "appSessionId":"1fa55cbb-7b02-a546-94a2-8986be7fce5b"
};

sdk.matter.openMatter(request);
```

#### Select matter(s)

```typescript
selectMatter(request?: SelectMatterRequest): Promise<Matter[]>;
```

### Person

#### Select staff

```typescript
selectStaff(request?: SelectStaffRequest): Promise<Staff[]>;
```

### MS Teams

#### Share a document

```typescript
shareDocument(request: ShareDocumentRequest): void;
```

#### Share a matter

```typescript
shareMatter(request: ShareMatterRequest): void;
```

#### Request a callback

```typescript
shareMatter(request: RequestCallbackRequest): void;
```

### Person

#### Select person(s) from the list

```typescript
selectPerson(request: SelectPersonRequest): Promise<Person[]>;
```

#### Open a person

```typescript
openPerson(request: OpenPerson): void;
```

### Register

#### Reload document register list

```typescript
reloadDocumentRegisterList(request: ReloadDocumentRegisterListRequest): void;
```

#### Reload power estate list

```typescript
reloadPowerEstateList(request: ReloadPowerEstateListRequest): void;
```

### Schema

#### Get schema list

```typescript
getLists(request: GetListsRequest): Promise<SchemaResponse<SchemaList[]>>;
```

#### Customise list

```typescript
customiseList(request: CustomiseListRequest): Promise<CustomiseListResponse>;
```

### System

#### Open Twitter window

```typescript
openTwitter(request: BaseRequest): void;
```

#### Close the current LEAP app

```typescript
close(): void;
```

#### Hide the current LEAP app

```typescript
hide(): void;
```

#### Show loading icon in LEAP

```typescript
wait(request?: MessageRequest): void;
```

#### Hide loading icon in LEAP

```typescript
resume(): void;
```

#### Show a message box in LEAP (Deprecated, replaced with openDialog)

```typescript
alert(): void;
```

#### Show an error message in LEAP (Deprecated, replaced with openDialog)

```typescript
error(): void;
```

#### Display a message on the dialog box in LEAP

```typescript
openDialog(request: DialogRequest): void;
```

#### Open an URL in browser

```typescript
openUrl(config: BrowserConfig): void;

//Request example:
const config = {
  "url": "https://app.test.bylawyers.com.au/",
  "openExternal": false,
  "useNativeLoading": false
  "width": 900,
  "height": 500,
  "minWidth": 800,
  "minHeight": 400,
  "maxWidth": 1000,
  "maxHeight": 600,
  "closeHandler": "jsFunction(parameter)",
  "fixedWindowSize": false,
  "independentWindow": false,
  "windowTitle": "Good day"
};

sdk.system.openUrl(config);
```

#### Get host system info

```typescript
getSystemInfo(): void;
```

#### Set window title

```typescript
setWindowTitle(request: SetWindowTitleRequest): void;
```

#### Register a handler to trigger before closing a window

```typescript
onBeforeClose(handler: () => Promise<boolean>): void;
```

#### Send a custom request object to the host

```typescript
send(request: object, hasResponse?: boolean): Promise<any>;
```

#### Notify the host system when your app has finished loading (to avoid having different loaders from LEAP and your app)

```typescript
finishLoading(): void;
```
